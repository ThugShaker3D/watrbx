;// bundle: chat___3e5573586d54b02b98ee8cf53afaabab_m
;// files: jquery.cookies.2.2.0.1.js, Chat.js, jquery-extensions.js, party.js

;// jquery.cookies.2.2.0.1.js
var jaaulde=window.jaaulde||{};jaaulde.utils=jaaulde.utils||{},jaaulde.utils.cookies=function(){var i,u,r,n,t={expiresAt:null,path:"/",domain:null,secure:!1};return i=function(n){var i,r;return typeof n!="object"||n===null?i=t:(i={expiresAt:t.expiresAt,path:t.path,domain:t.domain,secure:t.secure},typeof n.expiresAt=="object"&&n.expiresAt instanceof Date?i.expiresAt=n.expiresAt:typeof n.hoursToLive=="number"&&n.hoursToLive!==0&&(r=new Date,r.setTime(r.getTime()+n.hoursToLive*36e5),i.expiresAt=r),typeof n.path=="string"&&n.path!==""&&(i.path=n.path),typeof n.domain=="string"&&n.domain!==""&&(i.domain=n.domain),n.secure===!0&&(i.secure=n.secure)),i},u=function(n){return n=i(n),(typeof n.expiresAt=="object"&&n.expiresAt instanceof Date?"; expires="+n.expiresAt.toGMTString():"")+"; path="+n.path+(typeof n.domain=="string"?"; domain="+n.domain:"")+(n.secure===!0?"; secure":"")},r=function(){for(var r={},i,u,n,f=document.cookie.split(";"),e,t=0;t<f.length;t=t+1){i=f[t].split("="),u=i[0].replace(/^\s*/,"").replace(/\s*$/,"");try{n=decodeURIComponent(i[1])}catch(o){n=i[1]}if(typeof JSON=="object"&&JSON!==null&&typeof JSON.parse=="function")try{e=n,n=JSON.parse(n)}catch(s){n=e}r[u]=n}return r},n=function(){},n.prototype.get=function(n){var t,i,u=r();if(typeof n=="string")t=typeof u[n]!="undefined"?u[n]:null;else if(typeof n=="object"&&n!==null){t={};for(i in n)t[n[i]]=typeof u[n[i]]!="undefined"?u[n[i]]:null}else t=u;return t},n.prototype.filter=function(n){var t,i={},u=r();typeof n=="string"&&(n=new RegExp(n));for(t in u)t.match(n)&&(i[t]=u[t]);return i},n.prototype.set=function(n,t,i){if((typeof i!="object"||i===null)&&(i={}),typeof t=="undefined"||t===null)t="",i.hoursToLive=-8760;else if(typeof t!="string")if(typeof JSON=="object"&&JSON!==null&&typeof JSON.stringify=="function")t=JSON.stringify(t);else throw new Error("cookies.set() received non-string value and could not serialize.");var r=u(i);document.cookie=n+"="+encodeURIComponent(t)+r},n.prototype.del=function(n,t){var r={},i;(typeof t!="object"||t===null)&&(t={}),typeof n=="boolean"&&n===!0?r=this.get():typeof n=="string"&&(r[n]=!0);for(i in r)typeof i=="string"&&i!==""&&this.set(i,null,t)},n.prototype.test=function(){var t=!1,n="cT",i="data";return this.set(n,i),this.get(n)===i&&(this.del(n),t=!0),t},n.prototype.setOptions=function(n){typeof n!="object"&&(n=null),t=i(n)},new n}(),function(){window.jQuery&&function(n){n.cookies=jaaulde.utils.cookies;var t={cookify:function(t){return this.each(function(){var f,e=["name","id"],u,i=n(this),r;for(f in e)if(!isNaN(f)&&(u=i.attr(e[f]),typeof u=="string"&&u!=="")){i.is(":checkbox, :radio")?i.attr("checked")&&(r=i.val()):r=i.is(":input")?i.val():i.html(),(typeof r!="string"||r==="")&&(r=null),n.cookies.set(u,r,t);break}})},cookieFill:function(){return this.each(function(){for(var u,e=["name","id"],r,t=n(this),i,f=function(){return u=e.pop(),!!u};f();)if(r=t.attr(u),typeof r=="string"&&r!==""){i=n.cookies.get(r),i!==null&&(t.is(":checkbox, :radio")?t.val()===i?t.attr("checked","checked"):t.removeAttr("checked"):t.is(":input")?t.val(i):t.html(i));break}})},cookieBind:function(t){return this.each(function(){var i=n(this);i.cookieFill().change(function(){i.cookify(t)})})}};n.each(t,function(t){n.fn[t]=this})}(window.jQuery)}();

;// Chat.js
var Party,ChatBar={};ChatBar.CurrentTabID=null,ChatBar.FriendsEnabled=!1,ChatBar.PartyEnabled=!1,ChatBar.UseSubdomainlessCookies=!1,ChatBar.NewCookieRollbackEnabled=!1,ChatBar.ChatPollIntervalTimer=null,ChatBar.ChatPollInterval=1500,ChatBar.IdleChatPollInterval=5e3,ChatBar.PollingStatus="normal",ChatBar.PollIntervalFactorForIdle=6,ChatBar.FriendsPollIntervalTimer=null,ChatBar.FriendsPollInterval=4e4,ChatBar.FriendsLastPoll=null,ChatBar.RecentsPollIntervalTimer=null,ChatBar.RecentsPollInterval=32e3,ChatBar.RecentsLastPoll=null,ChatBar.MaxChatWindows=4,ChatBar.NumChatWindows=0,ChatBar.ActiveChats=null,ChatBar.Recents=[],ChatBar.Friends=[],ChatBar.ActiveChatsOnlineStatus=[],ChatBar.MyUserName="",ChatBar.IsFirstLoad=!0,ChatBar.PollCount=0,ChatBar.LastPollTime=0,ChatBar.LastActivityTimeInTicks=+new Date,ChatBar.WindowIsInFocus=!0,ChatBar.RawData={},ChatBar.SoundPlayerIsReady=!1,ChatBar.AlreadyReceivedMessages=[],ChatBar.PageTitle=document.title,ChatBar.PageTitleIndicatorIntervalTimer=null,ChatBar.ActiveBlinkers=[],ChatBar.ChatTabBlinker=null,ChatBar.ChatThreadAvailable=!0,ChatBar.FriendsThreadAvailable=!0,ChatBar.DiagnosticsEnabled=!1,ChatBar.CurrentChatPollInterval=null,ChatBar.ReportAbuse=function(n){confirm(Roblox.Chat.Resources.reportConfirm)&&(window.location.href="/abusereport/chat?id="+n+"&redirectUrl="+escape(window.location))},ChatBar.BindDropDown=function(n,t){ChatBar.SetPartyInviteStatus(t.ID,t.ShowInviteLink=="true"),$(".friend_dock_chatbox[userid="+t.ID+"]").is(":visible")&&($(".StartChat[userid="+t.ID+"]").hide(),$(".EndChat[userid="+t.ID+"]").show()),$(n).children(".friend-bar-dropdown-button").click(function(){$(this).siblings(".friendBarDropDownList").show()}),$(n).hover(function(){},function(){$(this).find(".friendBarDropDownList").hide()}),$(n).find("li").click(function(){$(this).parent().parent().hide()});var i=$(n).parent();$(i).hover(function(){$(this).children(".friendBarDropDown").show()},function(){$(this).children(".friendBarDropDown").hide()})},ChatBar.Log=function(n){if(ChatBar.DiagnosticsEnabled&&window.console){var t=new Date,i="CHATLOG "+t.toLocaleTimeString()+":"+t.getMilliseconds()+" | ";console.log(i+n)}},ChatBar.OnPageLoad=function(){var n,t;$(document).on("keyup",".friend_dock_chatbox_entry",function(n){if(n.keyCode==13){if($.trim(this.value)==""){this.value="";return}return ChatBar.SendMessage($(this)),!1}return!0});ChatBar.Log("ChatBar.OnPageLoad"),ChatBar.LoadStateFromClient(),n=$("#friend_dock_minimized_container:visible"),n.length>0?(ChatBar.CurrentChatPollInterval=ChatBar.IdleChatPollInterval,ChatBar.Log("onpageload Detected chat minimized, ChatBar.ChatPollIntervalTimer to "+ChatBar.CurrentChatPollInterval),ChatBar.PollingStatus="idle",ChatBar.ChatPollIntervalTimer=setInterval(function(){ChatBar.PollForChats()},ChatBar.CurrentChatPollInterval)):(ChatBar.CurrentChatPollInterval=ChatBar.ChatPollInterval,ChatBar.Log("onpageload Detected chat maximized, ChatBar.ChatPollIntervalTimer to "+ChatBar.CurrentChatPollInterval),ChatBar.PollingStatus="normal",ChatBar.ChatPollIntervalTimer=setInterval(function(){ChatBar.PollForChats()},ChatBar.CurrentChatPollInterval)),ChatBar.ChatThreadAvailable==!0?ChatBar.PollForChats():setTimeout(function(){ChatBar.PollForChats()},500),t=navigator.appName=="Microsoft Internet Explorer",t?(document.onfocusout=function(){ChatBar.OnFocusOut()},document.onfocusin=function(){ChatBar.OnFocusIn()}):(window.onblur=function(){ChatBar.OnFocusOut()},window.onfocus=function(){ChatBar.OnFocusIn()}),window.onbeforeunload=function(){ChatBar.SaveStateToClient()},$("#jPlayerDiv").jPlayer({swfPath:"/js/jPlayer/"+ChatBar.jPlayerVersion+"/jquery.jplayer.swf",solution:"flash, html",supplied:"mp3, wav",wmode:"transparent",errorAlerts:!1,warningAlerts:!1,ready:function(){$("#jPlayerDiv").jPlayer("setMedia",{mp3:ChatBar.ChatReceivedSoundFile}),ChatBar.SoundPlayerIsReady=!0}})},ChatBar.PlaySound=function(n){ChatBar.SoundPlayerIsReady&&!ChatBar.WindowIsInFocus&&ChatBar.ChatNotificationsSetting!="None"&&n==="msgrec"&&$("#jPlayerDiv").jPlayer("play")},ChatBar.GetOpenChats=function(){var t=0,n="";return $(".friend_dock_chatbox:visible").each(function(){n+=$(this).attr("userid")+",",t++}),n},ChatBar.GetAllChats=function(){var t="",n;if(ChatBar.ActiveChats==null)return"";for(n=0;n<ChatBar.ActiveChats.length;n++)t+=ChatBar.ActiveChats[n].SenderID+",";return t},ChatBar.ApplySettings=function(){var i="",n,t;$("#chat_settings_all").attr("checked")?i="All":$("#chat_settings_friends").attr("checked")?i="Friends":$("#chat_settings_noone").attr("checked")&&(i="Noone"),n="",ChatBar.PartyEnabled&&($("#party_settings_all").attr("checked")?n="All":$("#party_settings_friends").attr("checked")?n="Friends":$("#party_settings_noone").attr("checked")&&(n="Noone")),t="",$("#chat_settings_soundon").attr("checked")?t="All":$("#chat_settings_soundoff").attr("checked")&&(t="None"),ChatBar.ChatNotificationsSetting=t,$.ajax({method:"GET",url:"/chat/utility.ashx",data:{reqtype:"setproperties",visibility:i,partyVisibility:n,notificationSetting:t},crossDomain:!0,xhrFields:{withCredentials:!0}}).done(function(){return})},ChatBar.GenerateUserOfflineSendPMMessage=function(n){return Roblox.Chat.Resources.sendPersonalMessage1+"<a href='/My/NewMessage.aspx?RecipientID="+n+"'>"+Roblox.Chat.Resources.sendPersonalMessage2+"</a>."},ChatBar.ShowOfflineMessage=function(n){var t="#"+n+"_friend_dock_chatbox_chat",i;$(t).length>0&&$(t).children(".chaterror").size()==0&&(i=ChatBar.GenerateUserOfflineSendPMMessage(n),$(t).append("<i class='chaterror'>"+i+"<br /><br /></i>"),$(t).prop({scrollTop:$(t).prop("scrollHeight")}))},ChatBar.EnableTextEntry=function(n){var t="#"+n+"_friend_dock_chatbox_chat";$(t)&&($(t).children(".friend_dock_chatbox_entry").prop("disabled",!1),$(t).children(".chaterror").size()>0&&$(t).children(".chaterror").remove())},ChatBar.BlockWindow=function(n){$(".friend_dock_chatbox[userid="+n+"]").append($("<div class='chat-loading-overlay'></div><div class='chat-loading-message'>Loading...</div>"))},ChatBar.UnblockAllWindows=function(){$(".chat-loading-message").remove(),$(".chat-loading-overlay").remove()},ChatBar.ResetPageTitle=function(){clearInterval(ChatBar.PageTitleIndicatorIntervalTimer),ChatBar.PageTitleIndicatorIntervalTimer=null,document.title=ChatBar.PageTitle},ChatBar.TogglePageTitleIndicator=function(n){var t=n;clearInterval(ChatBar.PageTitleIndicatorIntervalTimer),ChatBar.PageTitleIndicatorIntervalTimer=setInterval(function(){document.title=document.title==ChatBar.PageTitle?t:ChatBar.PageTitle},2e3)},ChatBar.OnFocusOut=function(){ChatBar.Log("ChatBar.OnFocusOut detected"),ChatBar.WindowIsInFocus=!1,clearInterval(ChatBar.ChatPollIntervalTimer),ChatBar.CurrentChatPollInterval=ChatBar.IdleChatPollInterval*2,ChatBar.Log("onfocusout Set chatpollintervalttimer to "+ChatBar.CurrentChatPollInterval),ChatBar.ChatPollIntervalTimer=setInterval(function(){ChatBar.PollForChats()},ChatBar.CurrentChatPollInterval),ChatBar.PollingStatus="idle",clearInterval(ChatBar.FriendsPollIntervalTimer),clearInterval(ChatBar.RecentsPollIntervalTimer)},ChatBar.OnFocusIn=function(){ChatBar.Log("ChatBar.OnFocusIn detected"),ChatBar.WindowIsInFocus=!0,clearInterval(ChatBar.ChatPollIntervalTimer),ChatBar.CurrentChatPollInterval=ChatBar.ChatPollInterval,ChatBar.Log("onfocusin Set chatpollintervalttimer to "+ChatBar.CurrentChatPollInterval),ChatBar.ChatPollIntervalTimer=setInterval(function(){ChatBar.PollForChats()},ChatBar.CurrentChatPollInterval),ChatBar.PollingStatus="normal",ChatBar.LastActivityTimeInTicks=+new Date,ChatBar.ResetPageTitle(),ChatBar.PollIfNecessary(ChatBar.CurrentTabID)},ChatBar.HideFriends=function(){$("#ChatContainer").css("width",""),$("#friend_dock_chatholder").hide(),$("#friend_dock_container").hide(),$("#friend_dock_minimized_container").show(),$("#partycontainer").css("position","relative"),ChatBar.OnFocusOut(),ChatBar.SetCookie("IsMinimized","true")},ChatBar.ShowFriends=function(){$("#ChatContainer").width("100%"),$("#friend_dock_container").show(),$("#friend_dock_minimized_container").hide(),$("#friend_dock_chatholder").show(),$("#partycontainer").css("position","absolute");var n=$("#friend_dock_container").html();n=n.replace(/min_src/g,"src"),$("#friend_dock_container").html(n),ChatBar.OnFocusIn(),ChatBar.SetCookie("IsMinimized","false")},ChatBar.SetPartyInviteStatus=function(n,t){t?$(".friend_dock_friend[userid="+n+"]").find(".partyInvite").show():$(".friend_dock_friend[userid="+n+"]").find(".partyInvite").hide()},ChatBar.UpdateChatZone=function(n){try{if(!$("#chats-tab-dock-thumbnails").find(".friend_dock_friend[userid="+n.SenderID+"]").length){var t=ChatBar.GenerateThumbFromTemplate(n),i=$("#chats-tab-dock-thumbnails").append(t);ChatBar.BindDropDown($(i).find(".friendBarDropDown"),n),$("#chats-tab-dock-thumbnails").children(".friend_dock_friend").size()>20&&$("#chats-tab-dock-thumbnails").children(".friend_dock_friend:last").remove()}}catch(r){}},ChatBar.LoadUserLocationIntoWindow=function(n){var i,r,u,t,f;n!=null&&(i=n.Location,i!==undefined&&i!=null)&&(r=null,r=n.SenderID!==undefined?n.SenderID:n.ID,u=null,u=n.SenderUserName!==undefined?n.SenderUserName:n.Name,$(".friend_dock_chatbox[userid="+r+"]").children(".friend_dock_chatbox_currentlocation").html(""),$(".friend_dock_chatbox[userid="+r+"]").children(".friend_dock_chatbox_currentlocation").css("height",""),t="",f=$(".friend_dock_friend[userid="+r+"] img").attr("src"),t+="<img style='margin-right:5px;margin-top:-5px;width:30px;height:30px;float:left' src='"+f+"' />",i=="website"?t+="<p><span style='color: green'>"+Roblox.Chat.Resources.online+"</span>: Website</p>":i=="offline"?t+="<p><span style='color: grey'>"+Roblox.Chat.Resources.offline+"</span></p>":(i.GameThumbnailURL&&(t+="<div style='width: 62px; float: left; margin-right: 10px; margin-bottom: 10px; cursor: pointer'><a href='"+i.GameAssetURL+"' style='text-decoration: none'><img src='"+i.GameThumbnailURL+"'/></a></div>"),t+="<div>",t+="<a href='#' style='text-decoration: none; color: black' onclick=\"",t+=$("#PlaceLauncherStatusPanel").data("is-protocol-handler-launch-enabled")=="True"?"Roblox.GameLauncher.followPlayerIntoGame("+r+");":"ChatBar.SetGoogleAnalyticsCallback(); Roblox.Client.WaitForRoblox(function() { RobloxLaunch.RequestFollowUser('PlaceLauncherStatusPanel', '"+r+"');});",t+='return false;">',t+="Join "+u+" in<br/><span style='font-weight: bold'><i>"+unescape(i.GameAssetName)+"</i></span>",t+="</a></div>"),$(".friend_dock_chatbox[userid="+r+"]").children(".friend_dock_chatbox_currentlocation").html(t))},ChatBar.SetGoogleAnalyticsCallback=function(){RobloxLaunch._GoogleAnalyticsCallback=function(){GoogleAnalyticsEvents.FireEvent("Play","User")}},ChatBar.LoadChatIntoWindow=function(n){var u,t,r,i,f,e;if(n!=null&&n.Conversation!==undefined&&n.Conversation!=null){for(u=n.Conversation,t=n.SenderID,$("#"+t+"_friend_dock_chatbox_chat").html(""),r=0;r<u.length;r++)i=u[r],f="chat-sender-self",ChatBar.MyUserName!=i.SenderUserName&&(f="chat-sender"),e=i.TimeSent.substring(1),$("#"+t+"_friend_dock_chatbox_chat").append("<div><span class='"+f+"'>"+i.SenderUserName+"</span>: <span class='chat-message-text'>"+Roblox.Linkify.String(i.Message)+"</span> <span class='hint-text'>("+e+")</span></div>");$("#"+t+"_friend_dock_chatbox_chat").prop({scrollTop:$("#"+t+"_friend_dock_chatbox_chat").prop("scrollHeight")})}},ChatBar.FindUserData=function(n){var t;if(ChatBar.ActiveChats!=null)for(t=0;t<ChatBar.ActiveChats.length;t++)if(ChatBar.ActiveChats[t].SenderID==n)return ChatBar.ActiveChats[t];if(ChatBar.Friends!=null)for(t=0;t<ChatBar.Friends.length;t++)if(ChatBar.Friends[t].ID==n)return ChatBar.Friends[t];if(ChatBar.Recents!=null)for(t=0;t<ChatBar.Recents.length;t++)if(ChatBar.Recents[t].ID==n)return ChatBar.Recents[t];return null},ChatBar.ToggleChat=function(n,t){var i=".friend_dock_chatbox[userid="+n+"]";$(i).is(":visible")?ChatBar.CloseChat($(i)):ChatBar.OpenChat(n,t),ChatBar.LastActivityTimeInTicks=+new Date,ChatBar.PollingStatus=="idle"&&(ChatBar.PollingStatus="normal",clearInterval(ChatBar.ChatPollIntervalTimer),ChatBar.CurrentChatPollInterval=ChatBar.ChatPollInterval,ChatBar.Log("toggle chat - status is idle, setting interval to normal, ChatBar.ChatPollInterval = "+ChatBar.CurrentChatPollInterval),ChatBar.ChatPollIntervalTimer=setInterval(function(){ChatBar.PollForChats()},ChatBar.CurrentChatPollInterval)),ChatBar.IsFirstLoad=!0,ChatBar.PollForChats()},ChatBar.CreateChatWindow=function(n,t){var r=".friend_dock_chatbox[userid="+n+"]",i;return $(r).length?$(r).is(":visible")||($(r).fadeIn(350),ChatBar.NumChatWindows++):(i=$("#friend_dock_chattemplate").html(),i=i.replace(/CHATUSERID/g,n),i=i.replace(/CHATUSERNAME/g,t),$("#friend_dock_chatholder").append(i),ChatBar.NumChatWindows++),$(r).click(function(){ChatBar.GiveElementFocus($(this).find(".friend_dock_chatbox_entry"))}),r},ChatBar.GiveElementFocus=function(n){$(n).focus(),$(n).siblings(".chat-header-blink-on").removeClass("chat-header-blink-on").addClass("chat-header-blink-off")},ChatBar.OnMessageReceived=function(n){var t,f,e,i,r,o,u;if(ChatBar.PlaySound("msgrec"),t=$(".chat-header-blink-off[userId="+n+"]"),!t||ChatBar.WindowIsInFocus&&$(t).siblings("textarea").is(":focus")||$(t).removeClass("chat-header-blink-off").addClass("chat-header-blink-on"),ChatBar.IsMinimized()){f=$("#minChatsTab"),e=setInterval(function(){$("#social-dock-tab").toggleClass("chat-tab-flash")},500);f.one("click",function(){clearInterval(e),$("#social-dock-tab").removeClass("chat-tab-flash"),$(".friend_dock_chatbox[userid="+n+"]").is(":visible")||(ChatBar.ToggleChat(n,ChatBar.FindUserData(n).SenderUserName),ChatBar.OnMessageReceived(n),ChatBar.TogglePanel("chats-tab"))})}if($(".friend_dock_chatbox[userid="+n+"]").length){if(i=ChatBar.ActiveBlinkers.indexOf(n),i==-1){ChatBar.ActiveBlinkers.push(n),r=$(".friend_dock_friend[userid="+n+"] .friend_dock_username"),o=setInterval(function(){r.toggle()},500);$(".friend_dock_chatbox[userid="+n+"]").one("click",function(){clearInterval(o),r.show(),ChatBar.ActiveBlinkers.splice(i,1)})}ChatBar.ChatTabBlinker==null&&(u=$("#chats-tab").parent(),ChatBar.ChatTabBlinker=setInterval(function(){ChatBar.ActiveBlinkers.length>0?u.toggleClass("chat-tab-flash"):(clearInterval(ChatBar.ChatTabBlinker),ChatBar.ChatTabBlinker=null,u.removeClass("chat-tab-flash"))},500))}},ChatBar.OpenChat=function(n,t){var r,i;$(".friend_dock_chatbox[userid="+n+"]").is(":visible")||($(".StartChat[userid="+n+"]").hide(),$(".EndChat[userid="+n+"]").show(),ChatBar.NumChatWindows>=ChatBar.MaxChatWindows&&ChatBar.CloseChat($(".friend_dock_chatbox:visible:first")),r=ChatBar.CreateChatWindow(n,t),ChatBar.BlockWindow(n),i=ChatBar.FindUserData(n),ChatBar.LoadChatIntoWindow(i),ChatBar.LoadUserLocationIntoWindow(i),i==null&&(ChatBar.ActiveChatsOnlineStatus!=null&&ChatBar.ActiveChatsOnlineStatus[n]!==undefined&&ChatBar.ActiveChatsOnlineStatus[n]===!1?ChatBar.ShowOfflineMessage(n):ChatBar.EnableTextEntry(n)))},ChatBar.CloseChat=function(n){if(n){var t=$(n).attr("userid");$(n).fadeOut(350),$(".StartChat[userid="+t+"]").show(),$(".EndChat[userid="+t+"]").hide(),ChatBar.NumChatWindows--}},ChatBar.ProcessPolledChatData=function(n){var r=0,u,t,i,o,f,s,e,h;for(ChatBar.ActiveChats=n,ChatBar.ActiveChats.length==0?($("#chats-tab-dock-thumbnails").html($("#chats-tab-dock-thumbnails-empty").attr("outerHTML")),$("#chats-tab-dock-thumbnails-empty").show()):$("#chats-tab-dock-thumbnails-empty").hide(),u=0;u<ChatBar.ActiveChats.length;u++)t=ChatBar.ActiveChats[u],i=t.SenderID,t.CachedOnClient=="false"&&(ChatBar.UpdateChatZone(t),o=t.Online=="true",ChatBar.SetOnline(i,o)),ChatBar.SetPartyInviteStatus(i,t.ShowInviteLink=="true"),f=t.HasNewMessages=="true",s=ChatBar.IsFirstLoad,(f||s)&&(e=$(".friend_dock_chatbox[userid="+i+"]:visible").length,h=$.cookie("ChatWindowOpened"+i),f&&(e?r++:ChatBar.IsMinimized()||h!=null||(setTimeout(function(){ChatBar.ToggleChat(i,t.SenderUserName),ChatBar.OnMessageReceived(i)},0),$.cookie("ChatWindowOpened"+i,!0)),ChatBar.OnMessageReceived(i)),e&&(ChatBar.LoadUserLocationIntoWindow(t),ChatBar.LoadChatIntoWindow(t))),r>0&&ChatBar.WindowIsInFocus==!0&&(ChatBar.LastActivityTimeInTicks=+new Date,ChatBar.PollingStatus=="idle"&&(ChatBar.PollingStatus="normal",clearInterval(ChatBar.ChatPollIntervalTimer),ChatBar.CurrentChatPollInterval=ChatBar.ChatPollInterval,ChatBar.Log("got a message while idle, speeding up polling to"+ChatBar.CurrentChatPollInterval),ChatBar.ChatPollIntervalTimer=setInterval(function(){ChatBar.PollForChats()},ChatBar.CurrentChatPollInterval)));ChatBar.ChatThreadAvailable=!0,ChatBar.WindowIsInFocus||(r==1?ChatBar.TogglePageTitleIndicator(Roblox.Chat.Resources.newMessage):r>1&&ChatBar.TogglePageTitleIndicator(Roblox.Chat.Resources.newMessages))},ChatBar.StopChatPolling=function(){clearInterval(ChatBar.ChatPollIntervalTimer),ChatBar.Log("Stopeed polling")},ChatBar.PollForChats=function(){var i,r,n,t;ChatBar.ChatThreadAvailable!=!1&&(ChatBar.ChatThreadAvailable=!1,i=ChatBar.PollCount%10==0?"true":"false",r=typeof Party!="undefined"&&Party.ActiveParty&&!Party.ActiveParty.PartyGuid?"true":"false",ChatBar.Log("Polling for Chat...   ChatBar.CurrentChatPollInterval = "+ChatBar.CurrentChatPollInterval),n={openChatTabs:ChatBar.GetOpenChats(),fullget:ChatBar.IsFirstLoad,activechatids:ChatBar.GetAllChats(),getstatusinfo:i,getpartystatus:r,timeZoneOffset:(new Date).getTimezoneOffset()},ChatBar.DiagnosticsEnabled&&(n.diag_poll_count=ChatBar.PollCount,n.diag_page=window.location.pathname+window.location.search,n.diag_state=ChatBar.IsMinimized()?"minimized":"maximized",n.diag_interval=ChatBar.CurrentChatPollInterval,t=+new Date,n.diag_since_last=ChatBar.LastPollTime==0?"first_time":t-ChatBar.LastPollTime,ChatBar.LastPollTime=t),$.ajax({method:"GET",url:"/chat/get.ashx?reqType=getallchatswithdata",data:n,crossDomain:!0,xhrFields:{withCredentials:!0}}).done(function(n){var t,r,i;try{if(n.Error===""){ChatBar.RawData=n,t=+new Date;try{n.PartyStatus!=null&&Party!=null&&Party.ActiveParty!=null&&(ChatBar.Log("party detected, data.PartyStatus = "+n.PartyStatus+", data.PartyStatus.Error = "+n.PartyStatus.Error),n.PartyStatus.Error!=null?ChatBar.Log("There was an error in party status.  Will not reset the interval"):(Party.ActiveParty=n.PartyStatus,ChatBar.LastActivityTimeInTicks=t,ChatBar.PollingStatus=="idle"&&(ChatBar.PollingStatus="normal",clearInterval(ChatBar.ChatPollIntervalTimer),ChatBar.CurrentChatPollInterval=ChatBar.ChatPollInterval,ChatBar.Log("Status was idle, set to normal, detected a party. set ChatBar.ChatPollInterval = "+ChatBar.CurrentChatPollInterval),ChatBar.ChatPollIntervalTimer=setInterval(function(){ChatBar.PollForChats()},ChatBar.CurrentChatPollInterval))))}catch(u){}ChatBar.ProcessPolledChatData(n.Chats),ChatBar.IsFirstLoad=!1,ChatBar.UnblockAllWindows(),ChatBar.PollCount++,r=3e4,i=t-ChatBar.LastActivityTimeInTicks,ChatBar.Log("Last activity time: "+ChatBar.LastActivityTimeInTicks+" time since last activity = "+i+" ChatBar.PollingStatus = "+ChatBar.PollingStatus),i>r&&ChatBar.PollingStatus=="normal"&&ChatBar.WindowIsInFocus==!0&&(ChatBar.PollingStatus="idle",clearInterval(ChatBar.ChatPollIntervalTimer),ChatBar.CurrentChatPollInterval=ChatBar.IdleChatPollInterval,ChatBar.Log("Detected idle and was normal and window was in focus, set status to idle, interval = "+ChatBar.CurrentChatPollInterval),ChatBar.ChatPollIntervalTimer=setInterval(function(){ChatBar.PollForChats()},ChatBar.CurrentChatPollInterval))}}catch(f){}}))},ChatBar.SetOnline=function(n,t){if(t)ChatBar.ActiveChatsOnlineStatus[n]=!0,$(".friend_dock_friend[userid="+n+"]").children(".friend_dock_onlinestatus").show(),$(".friend_dock_friend[userid="+n+"]").children(".friend_dock_offlinestatus").hide(),ChatBar.EnableTextEntry(n);else{var i="#"+n+"_friend_dock_chatbox";$(i)&&$(i).children(".friend_dock_chatbox_currentlocation").html("<p><span style='color: grey'>Offline</span></p>"),ChatBar.ActiveChatsOnlineStatus[n]=!1,$(".friend_dock_friend[userid="+n+"]").children(".friend_dock_onlinestatus").hide(),$(".friend_dock_friend[userid="+n+"]").children(".friend_dock_offlinestatus").show(),ChatBar.ShowOfflineMessage(n)}},ChatBar.RefreshFriends=function(n){ChatBar.ChatThreadAvailable=!1,$.ajax({method:"GET",url:"/chat/friendhandler.ashx?cmd="+n,crossDomain:!0,xhrFields:{withCredentials:!0}}).done(function(t){var r,i,u,f,e;try{if(ChatBar.ChatThreadAvailable=!0,t.Error===""){if(r="#friends-tab-dock-thumbnails",n=="recents"&&(r="#recents-tab-dock-thumbnails"),t.Count==0){$(r).html($(r+"-empty").show());return}for(n=="recents"?(ChatBar.RecentsLastPoll=new Date,ChatBar.Recents=t.Users):n=="friends"&&(ChatBar.Friends=t.Users,ChatBar.FriendsLastPoll=new Date),$(r+"-empty").hide(),i=0;i<t.Users.length;i++)$(r).children(".friend_dock_friend[userid="+t.Users[i].ID+"]").length?(t.Users[i].Online=="true"?ChatBar.SetOnline(t.Users[i].ID,!0):ChatBar.SetOnline(t.Users[i].ID,!1),ChatBar.SetPartyInviteStatus(t.Users[i].ID,t.Users[i].ShowInviteLink=="true")):(u=ChatBar.GenerateThumbFromTemplate(t.Users[i]),f=$(r).append(u),ChatBar.BindDropDown($(f).find(".friendBarDropDown"),t.Users[i]),e=t.Users[i].Online=="true",ChatBar.SetOnline(t.Users[i].ID,e));$(".friendBarDropDown").hover(function(){$(this).find("ul").show()},function(){$(this).find("ul").fadeOut("fast")}),$(".friendBarDropDown > li").click(function(){$(this).parent().fadeOut("fast")})}else $("#friend_dock_container").hide()}catch(o){}})},ChatBar.GenerateThumbFromTemplate=function(n){var t=$("#friend_dock_friendtemplate").html(),r=null,i;return r=n.SenderID!==undefined?n.SenderID:n.ID,i=null,i=n.SenderUserName!==undefined?n.SenderUserName:n.Name,t=t.replace(/UID/g,r),t=t.replace(/USERNAMETRUNCATED/g,fitStringToWidth(i,55,"friend_dock_username_href")),t=t.replace(/USERNAME/g,i),t=ChatBar.IsMinimized()?t.replace(/thumbnail_holder/g," min_src='"+n.Thumbnail+"' "):t.replace(/thumbnail_holder/g," src='"+n.Thumbnail+"' "),t=n.Online=="true"&&n.CanAcceptChats=="true"?t.replace("startchattingdisplay","style='display:block;'"):t.replace("startchattingdisplay","style='display:none;'"),t=n.Online=="true"?t.replace("startpartydisplay","style='display:block;'"):t.replace("startpartydisplay","style='display:none;'")},ChatBar.RemoveActiveChat=function(n){if(n){var t=$(n).attr("userid");$.ajax({method:"GET",url:"/chat/utility.ashx?reqtype=removechat&targetuserid="+t,crossDomain:!0,xhrFields:{withCredentials:!0}}).done(function(n){n.Result=="true"&&($("#chats-tab-dock-thumbnails .friend_dock_friend[userid="+t+"]").remove(),ChatBar.CloseChat($(".friend_dock_chatbox[userid="+t+"]")))})}},ChatBar.DisplayLocalMessageInWindow=function(n,t){var i=$("#"+n+"_friend_dock_chatbox_chat");i.append("<div><span class='chat-sender-self'>"+ChatBar.MyUserName+"</span>: <span class='chat-message-text'>"+Roblox.Linkify.String(t)+"</span></div>"),i.prop({scrollTop:i.prop("scrollHeight")})},ChatBar.SendMessage=function(n){var t=n.parents(".friend_dock_chatbox").attr("userid"),i=$.trim(n.val()),r,u;i!=""&&(ChatBar.LastActivityTimeInTicks=+new Date,ChatBar.PollingStatus=="idle"&&(ChatBar.PollingStatus="normal",clearInterval(ChatBar.ChatPollIntervalTimer),ChatBar.CurrentChatPollInterval=ChatBar.ChatPollInterval,ChatBar.Log("Sent message, was idle, set mode to normal and interval = "+ChatBar.CurrentChatPollInterval),ChatBar.ChatPollIntervalTimer=setInterval(function(){ChatBar.PollForChats()},ChatBar.CurrentChatPollInterval)),r=i.escapeHTML(),ChatBar.DisplayLocalMessageInWindow(t,r),n.val(""),u="/chat/send.ashx?recipientUserId="+t,$.ajax({url:u,type:"POST",crossDomain:!0,xhrFields:{withCredentials:!0},data:"message="+encodeURIComponent(i),success:function(n){n.Error!=""&&n.Error!="ModeratedMessage"&&ChatBar.ShowOfflineMessage(t)}}))},ChatBar.TogglePanel=function(n){n!=ChatBar.CurrentTabID&&(ChatBar.CurrentTabID!=null&&($("#"+ChatBar.CurrentTabID).parent().removeClass("active"),$("#"+ChatBar.CurrentTabID+"-dock-thumbnails").hide()),$("#"+n).parent().addClass("active"),ChatBar.CurrentTabID=="friends-tab"?clearInterval(ChatBar.FriendsPollIntervalTimer):ChatBar.CurrentTabID=="recents-tab"&&clearInterval(ChatBar.RecentsPollIntervalTimer),ChatBar.PollIfNecessary(n),$("#"+n+"-dock-thumbnails").show(),ChatBar.CurrentTabID=n)},ChatBar.PollIfNecessary=function(n){ChatBar.IsMinimized()||(n=="friends-tab"?(ChatBar.FriendsPollIntervalTimer=setInterval(function(){ChatBar.RefreshFriends("friends")},ChatBar.FriendsPollInterval),(ChatBar.FriendsLastPoll==null||+new Date-ChatBar.FriendsLastPoll.getTime()>ChatBar.FriendsPollInterval)&&ChatBar.RefreshFriends("friends")):n=="recents-tab"&&(ChatBar.RecentsPollIntervalTimer=setInterval(function(){ChatBar.RefreshFriends("recents")},ChatBar.RecentsPollInterval),(ChatBar.RecentsLastPoll==null||+new Date-ChatBar.RecentsLastPoll.getTime()>ChatBar.RecentsPollInterval)&&ChatBar.RefreshFriends("recents")))},ChatBar.SaveStateToClient=function(){var e=[],n=0,o,s,i,r,u,f,t,h;$(".friend_dock_chatbox:visible").each(function(){var t={};t.userid=$(this).attr("userid"),t.username=$(this).children(".friend_dock_chatbox_titlebar").children(".friend_dock_chatbox_username").children(".friend_dock_chatbox_username_display").html(),e[n]=t,n++}),o=JSON.stringify(e),s="friends",$("#friend_dock_chatzone:visible").length&&(s="chat"),i="true",$("#friend_dock_container:visible").length&&(i="false"),r="false",$("#party-container").is(":visible")&&(r="true"),ChatBar.SetCookie("ChatWindows",o),ChatBar.SetCookie("CurrentTabID",ChatBar.CurrentTabID),ChatBar.SetCookie("IsMinimized",i),ChatBar.SetCookie("PartyWindowVisible",r),ChatBar.AlreadyReceivedMessages.length&&ChatBar.SetCookie("RecMsgs",ChatBar.AlreadyReceivedMessages),u=[],f=0;for(n in ChatBar.ActiveChatsOnlineStatus)t={},t.userid=n,t.online=ChatBar.ActiveChatsOnlineStatus[n],u[f]=t,f++;h=JSON.stringify(u),ChatBar.SetCookie("OnlineStatuses",h)},ChatBar.SetCookie=function(n,t){ChatBar.UseSubdomainlessCookies?($.cookies.set(n,null),$.cookies.set(n,t,{domain:ChatBar.CookieDomain})):(ChatBar.NewCookieRollbackEnabled&&$.cookies.set(n,null,{domain:ChatBar.CookieDomain}),$.cookies.set(n,t))},ChatBar.LoadStateFromClient=function(){var i=null,r=null,u=null,f=null,t,e,n;if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)&&RegExp.$1<8){try{i=eval("("+$.cookies.get("ChatWindows")+")")}catch(o){}try{r=eval("("+$.cookies.get("OnlineStatuses")+")")}catch(o){}try{u=eval("("+$.cookies.get("PartyWindowVisible")+")")}catch(o){}try{f=$.cookies.get("IsMinimized"),f||$("#ChatContainer").width("100%")}catch(o){}t=$.cookies.get("RecMsgs"),t!=null&&t.length&&(ChatBar.AlreadyReceivedMessages=eval("("+t+")"))}else i=$.cookies.get("ChatWindows"),r=$.cookies.get("OnlineStatuses"),u=$.cookies.get("PartyWindowVisible"),f=$.cookies.get("IsMinimized"),f||$("#ChatContainer").width("100%"),t=$.cookies.get("RecMsgs"),t!=null&&t.length&&(ChatBar.AlreadyReceivedMessages=t);if(e=$.cookies.get("CurrentTabID"),r!=null)for(n=0;n<r.length;n++)ChatBar.ActiveChatsOnlineStatus[r[n].userid]=r[n].online;u!=null&&(u==!0||u=="true")&&Party.ToggleTab(!0);try{if(i!=null)for(n=0;n<i.length;n++)ChatBar.OpenChat(i[n].userid,i[n].username);e!=null?ChatBar.TogglePanel(e):ChatBar.TogglePanel("friends-tab")}catch(s){}},ChatBar.IsMinimized=function(){return $("#friend_dock_minimized_container").is(":visible")};

;// jquery-extensions.js
jQuery.extend(jQuery.expr[":"],{focus:function(n){return n==document.activeElement}});

;// party.js
var Party={};Party.ToggleTab=function(n){n==null?$("#party-container").toggle():$("#party-container").toggle(n)},Party.SetActiveView=function(n){$(".party-window").hide(),$("#"+n).show(),Party.ActiveView=n},Party.CreateNew=function(){Party.ActiveView!="party_my"&&(Party.SetActiveView("party_my"),$("#chat_messages").html("")),$.ajax({method:"GET",url:"/chat/party.ashx",data:{reqtype:"create"},crossDomain:!0,xhrFields:{withCredentials:!0}}).done(function(n){return Party.HandleError(n)?!1:(Party.ProcessPolledData(n),Party.FirstLoad=!0,Party.Refresh(),Party.PollForUpdates(),Party.ToggleTab(!0),!0)})},Party.DoInvite=function(n){elem=$("#"+n),Party.InviteUser(elem.val()),elem.val("")},Party.GenerateReportUserURLHTML=function(n){var t=$("<span>"),i;return t.attr("class","report-link"),t.attr("data-user-name",n.UserName),t.attr("data-user-id",n.UserID),t.text(Party.Resources.report),i=$("<span>"),i.append("("),i.append(t),i.append(")"),$("<div>").append(i).html()},Party.GenerateKickUserHTML=function(n){var t=$("<div>");return t.attr("id","party_kick_"+n),t.attr("class","kick-user"),t.attr("title","Kick from party"),t.attr("data-user-id",n),$("<div>").append(t).html()},Party.GetMemberListAsHtml=function(){for(var r="",u=$("#partyMemberTemplate").html(),f=Party.AmILeader(),n,i,t=0;t<Party.ActiveParty.Members.length;t++)n=u.replace(/UID/g,Party.ActiveParty.Members[t].UserID),(Party.ActiveParty.Members[t].IsOnline==!0||Party.ActiveParty.Members[t].IsOnline=="True")&&(n=n.replace("friend_dock_offlinestatus","friend_dock_onlinestatus")),n=n.replace("[PARTY_MEMBER_THUMBNAIL]","<img src='"+Party.ActiveParty.Members[t].Thumbnail+"' style='width:24px;height:24px'/>"),n=t==0?n.replace("[PARTY_MEMBER_NAME]","<strong>"+Party.ActiveParty.Members[t].UserName+"</strong>"):n.replace("[PARTY_MEMBER_NAME]",Party.ActiveParty.Members[t].UserName),n=f&&Party.ActiveParty.Members[t].UserID!=Party.CurrentUserID?n.replace("[PARTY_KICK_MEMBER]",Party.GenerateKickUserHTML(Party.ActiveParty.Members[t].UserID)):n.replace("[PARTY_KICK_MEMBER]",""),Party.ActiveParty.Members[t].Pending==!1?(i="",Party.ActiveParty.Members[t].UserID!=Party.CurrentUserID&&(i=Party.GenerateReportUserURLHTML(Party.ActiveParty.Members[t])),n=n.replace("[PARTY_MEMBER_REPORT]",i)):n=n.replace("[PARTY_MEMBER_REPORT]","<span style='color: grey'>"+Party.Resources.pending+"</span>"),r+=n+"";return r},Party.ProcessKey=function(n,t){return(t==null&&(t=window.event),t.keyCode==13)?(Party.DoInvite(n),!1):!0},Party.Refresh=function(){var n,t,u,r,i,e,o,f;if(Party.ActiveParty.PartyGuid)if(Party.ActiveParty.Members.length>1){for(n=0;n<Party.ActiveParty.Members.length;n++)if(Party.ActiveParty.Members[n].UserID==Party.CurrentUserID){if(Party.ActiveParty.Members[n].Pending==!0&&Party.ActiveView!="party_pending")Party.Cache.Updated&&$("#party_invite_list").html(Party.GetMemberListAsHtml()),Party.SetActiveView("party_pending"),$("#invite-header").html($("#invite-header").html().replace("RobloTim",Party.ActiveParty.CreatorName)),Party.ToggleTab(!0),t=document.title,document.title=Party.Resources.partyInvite,document.getElementById("party_pending_title").className="title title-flash",setTimeout('document.title = "'+t+"\"; document.getElementById('party_pending_title').className = 'title';",500),setTimeout('document.title = "'+Party.Resources.partyInvite+"\"; document.getElementById('party_pending_title').className = 'title title-flash';",1e3),setTimeout('document.title = "'+t+"\"; document.getElementById('party_pending_title').className = 'title';",1500),setTimeout('document.title = "'+Party.Resources.partyInvite+"\"; document.getElementById('party_pending_title').className = 'title title-flash';",2e3),setTimeout('document.title = "'+t+"\"; document.getElementById('party_pending_title').className = 'title';",2500),setTimeout('document.title = "'+Party.Resources.partyInvite+"\"; document.getElementById('party_pending_title').className = 'title title-flash';",3e3),setTimeout('document.title = "'+t+"\"; document.getElementById('party_pending_title').className = 'title';",3500);else if(Party.ActiveParty.Members[n].Pending==!1){if(Party.Cache.Updated&&$("#party_member_list").html(Party.GetMemberListAsHtml()),Party.ActiveView!="party_my"&&(Party.SetActiveView("party_my"),$("#chat_messages").html("")),Party.ActiveParty.Members[n].HasUpdates||Party.FirstLoad==!0){for(Party.FirstLoad=!1,u="",r=Party.ActiveParty.Conversation,i=0;i<r.length;i++)e=r[i].SenderUserName,o=Roblox.Linkify.String(r[i].Message),u+="<div class='party-chat-message'><span class='chat-sender-self'>"+e+"</span>: "+o+"</div>";f=$("#chat_messages"),$(f).html(""),$(f).append(u),typeof ChatBar.PlaySound=="function"&&ChatBar.PlaySound("msgrec"),window.setTimeout(function(){$("#chat_messages").prop({scrollTop:$("#chat_messages").prop("scrollHeight")})},300)}Party.CurrentUserID!=Party.ActiveParty.CreatorID&&$("#party_invite_instructions").hide(),Party.PlayEnabled&&Party.CurrentUserID!=Party.ActiveParty.CreatorID?$("#party-auto-follow-setting").show():$("#party-auto-follow-setting").hide(),Party.PlayEnabled!=!0?($("#party_game_thumb").html(""),$("#party_game_name").html(""),$("#party_game_follow_me").hide()):Party.ActiveParty.PartyGameAsset!=null?(Party.ActiveParty.PartyGameThumbnail==null||Party.ActiveParty.PartyGameThumbnail.IsFinal==!1?$("#party_game_thumb").html("<a href='/Item.aspx?id="+Party.ActiveParty.PartyGameAsset.ID+"'><img src='/images/empty.png' width='75' height='75' alt='"+Party.ActiveParty.PartyGameAsset.Name.escapeHTML()+"' /></a>"):$("#party_game_thumb").html("<a href='/Item.aspx?id="+Party.ActiveParty.PartyGameAsset.ID+"'><img src='"+Party.ActiveParty.PartyGameThumbnail.Url+"' alt='"+Party.ActiveParty.PartyGameAsset.Name.escapeHTML()+"' /></a>"),$("#party_game_name").html(Party.ActiveParty.PartyGameAsset.Name.escapeHTML()),$("#party_game_follow_me").show(),Party.ToggleTab(!0),Party.ActiveParty.PartyLeaderIsInGame==!1||Party.ActiveParty.PartyLeaderIsInGame=="False"?$("#party_game_follow_me").addClass("btn-disabled-primary"):$("#party_game_follow_me").removeClass("btn-disabled-primary")):($("#party_game_thumb").html(""),$("#party_game_name").html(""),$("#party_game_follow_me").hide())}break}}else Party.SetActiveView("party_none"),Party.RemoveUser(Party.CurrentUserID);else Party.SetActiveView("party_none")},Party.PollForUpdates=function(){Party.PollThreadAvailable&&Party.ActiveParty.PartyGuid&&(Party.PollThreadAvailable=!1,$.ajax({method:"GET",url:"/chat/party.ashx",data:{reqtype:"get"},crossDomain:!0,xhrFields:{withCredentials:!0}}).done(function(n){Party.ProcessPolledData(n),Party.PollThreadAvailable=!0,Party.Refresh()}))},Party.SendMessage=function(n){if($.trim(n)!=""){var t=n.escapeHTML();t=Roblox.Linkify.String(t),$("#chat_messages").append("<div class='party-chat-message'><span class='chat-sender-self'>"+Party.CurrentUserName+"</span>: "+t+"</div>"),$("#chat_messages").prop({scrollTop:$("#chat_messages").prop("scrollHeight")}),$("#comments").val(""),$.ajax({url:"/chat/send.ashx?partyGuid="+Party.ActiveParty.PartyGuid,type:"POST",data:"message="+encodeURIComponent(n),success:Party.HandleError,crossDomain:!0,xhrFields:{withCredentials:!0}})}},Party.RemoveUser=function(n){$("#party_kick_"+n).html("<img src='/images/spinners/waiting.gif' />"),$.ajax({method:"GET",url:"/chat/party.ashx",data:{reqtype:"removeUser",userid:n},crossDomain:!0,xhrFields:{withCredentials:!0}}).done(function(t){Party.HandleError(t)||($("#party_kick_"+n).remove(),$("#party_pendinguserid_"+n).remove(),Party.PollForUpdates())})},Party.InviteUser=function(n){n=n.trim(),n==null||n==""?alert(Party.Resources.inviteInstructions):Party.ActiveParty==null||typeof Party.ActiveParty.Members=="undefined"?(Party.SetActiveView("party_loading"),$.ajax({method:"GET",url:"/chat/party.ashx",data:{reqtype:"createAndInvite",userName:n},crossDomain:!0,xhrFields:{withCredentials:!0}}).done(function(n){if(Party.HandleError(n))return Party.PollForUpdates(),Party.SetActiveView("party_none"),!0;Party.ProcessPolledData(n),Party.SetActiveView("party_my"),Party.FirstLoad=!0,Party.Refresh(),Party.PollForUpdates(),Party.ToggleTab(!0)})):(typeof Party.ActiveParty.Error=="undefined"||Party.ActiveParty.Error=="")&&(Party.ActiveParty.Members.length>=Party.MaxPartySize?alert(Party.Resources.partyFull):$.ajax({method:"GET",url:"/chat/party.ashx",data:{reqtype:"inviteUser",userName:n},crossDomain:!0,xhrFields:{withCredentials:!0}}).done(function(n){Party.HandleError(n),Party.PollForUpdates()}))},Party.AcceptInvite=function(){$.ajax({method:"GET",url:"/chat/party.ashx",data:{reqtype:"acceptInvite"},crossDomain:!0,xhrFields:{withCredentials:!0}}).done(function(n){Party.HandleError(n),Party.FirstLoad=!0,Party.ProcessPolledData(n),Party.Refresh()})},Party.DeclineInvite=function(){Party.SetActiveView("party_none"),$.ajax({method:"GET",url:"/chat/party.ashx",data:{reqtype:"removeUser",userID:Party.CurrentUserID},crossDomain:!0,xhrFields:{withCredentials:!0}}).done(function(n){Party.HandleError(n),Party.ProcessPolledData(n),Party.Refresh()})},Party.HandleError=function(n){return n.Error?(alert(n.Error),!0):!1},Party.AmILeader=function(){return Party.ActiveParty&&Party.CurrentUserID==Party.ActiveParty.CreatorID},Party.ProcessPolledData=function(n){var t,r,i,u;if(n!=null){if(Party.ActiveParty=n,Party.ActiveParty.Members)for(t=0;t<Party.ActiveParty.Members.length;t++)Party.ActiveParty.Members[t].UserID==Party.CurrentUserID&&(r=Party.ActiveParty.Members[t]);Party.AmILeader()||Party.ActiveParty.PartyGuid==null||Party.ActiveParty.PartyGameAsset==null||r==null||r.Pending?(typeof Party.ActiveParty.Members=="undefined"||Party.ActiveParty.Members.length<=1)&&Party.SetActiveView("party_none"):(i=JSON.parse(sessionStorage.getItem("PartyStorage")||"{}"),i.AcknowledgedGameGuid&&i.AcknowledgedGameGuid==Party.ActiveParty.GameGuid||(u=Party.ActiveParty.PartyGameAsset.Name,(r.AutoFollowPartyLeader||confirm(Party.Resources.joinConfirm1+u+Party.Resources.joinConfirm2+"\n\n"+Party.Resources.joinConfirm3))&&Party.JoinGameWithParty(),i.AcknowledgedGameGuid=Party.ActiveParty.GameGuid,sessionStorage.setItem("PartyStorage",JSON.stringify(i)))),Party.UpdateCache()}},Party.JoinGameWithParty=function(){var n=Party.ActiveParty.PartyGameAsset.ID,t,i;play_placeId=n,t=Party.ActiveParty.PartyGuid,i=Party.ActiveParty.GameGuid,Roblox.GamePlayEvents&&Roblox.GamePlayEvents.SendGamePlayIntent("Party",n),$("#PlaceLauncherStatusPanel").data("is-protocol-handler-launch-enabled")=="True"?Roblox.GameLauncher.joinGameWithParty(n,t,i):(Party.SetGoogleAnalyticsCallback(n),Roblox.Client.WaitForRoblox(function(){RobloxLaunch.RequestPlayWithParty("PlaceLauncherStatusPanel",n,t,i)}))},Party.SetGoogleAnalyticsCallback=function(n){RobloxLaunch._GoogleAnalyticsCallback=function(){GoogleAnalyticsEvents.FireEvent("Play","User"),RobloxEventManager.triggerEvent("rbx_evt_play_user",{placeId:n})}},Party.OnPageLoad=function(){$(".closeparty").click(function(){Party.ToggleTab(null)});$(document).on("keydown","#comments",function(n){return n.keyCode==13?(Party.SendMessage($("#comments").val()),!1):!0});$("#party_my .main").css("max-height",$(window).height()-150),$(".party-invite-box").val(Party.Resources.enterUserName),$(".party-invite-box").focus(function(){this.value==Party.Resources.enterUserName?this.value="":this.select()}),$(".party-invite-box").blur(function(){$.trim(this.value)==""&&(this.value=Party.Resources.enterUserName)});$(".party-window").on("click",".report-link",function(){return confirm(Party.Resources.areYouSureReport+$(this).data("user-name")+"?")?(window.location="/abusereport/partychat?partyguid="+Party.ActiveParty.PartyGuid+"&id="+$(this).data("user-id"),!0):!1});$(".party-window").on("click",".kick-user",function(){return Party.RemoveUser($(this).data("user-id")),!1});Party.Refresh(),Party.PollIntervalTimer=setInterval(function(){Party.PollForUpdates()},3e3)},Party.Cache={},Party.Cache.Members=[],Party.Cache.Updated=!1,Party.UpdateCache=function(){var n,t;if(typeof Party.ActiveParty.Members=="undefined"||Party.Cache.Members.length!=Party.ActiveParty.Members.length)return Party.Cache.Members=Party.ActiveParty.Members||[],Party.Cache.Updated=!0,!0;for(Party.Cache.Updated=!1,n=0;n<Party.ActiveParty.Members.length;n++)for(t in Party.ActiveParty.Members[n])if(Party.ActiveParty.Members[n].hasOwnProperty(t)&&Party.Cache.Members[n][t]!=Party.ActiveParty.Members[n][t])return Party.Cache.Members=Party.ActiveParty.Members,Party.Cache.Updated=!0,!0;return!1};
